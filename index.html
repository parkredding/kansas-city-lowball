<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- ============================================
         NATIVE SHELL: Technical Lockdown Meta Tags
         PWA Gaming Design System v1.0
         ============================================ -->

    <!-- CRITICAL: The viewport meta tag that "seals" the app
         - width=device-width: Match device width exactly
         - initial-scale=1.0: No initial zoom
         - maximum-scale=1.0: Prevent pinch-to-zoom entirely
         - user-scalable=no: Disable double-tap zoom (removes 300ms delay)
         - viewport-fit=cover: Extend into iPhone notch/home indicator areas
         - interactive-widget=resizes-content: Proper keyboard handling on mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content" />

    <!-- iOS Safari: Standalone PWA configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="KC Lowball" />

    <!-- iOS Safari: Disable automatic detection (prevents unwanted link styling) -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="date=no" />
    <meta name="format-detection" content="email=no" />
    <meta name="format-detection" content="address=no" />

    <!-- Android Chrome: Theme color for status bar and PWA header -->
    <meta name="theme-color" content="#0f172a" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- Prevent browser caching of this HTML file -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- Disable Microsoft Edge/IE features -->
    <meta name="msapplication-tap-highlight" content="no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/kansas-city-lowball/manifest.json" />

    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kansas-city-lowball/icons/icon-192x192.png" />

    <!-- Preconnect to critical origins for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />

    <title>Kansas City Lowball</title>

    <!-- Inline critical CSS for instant paint (prevents flash of unstyled content) -->
    <style>
      /* Prevent flash - set background immediately */
      html, body {
        background-color: #0f172a;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script>
      // GitHub Pages SPA routing - restore path from 404 redirect
      (function() {
        var redirect = sessionStorage.getItem('spa-redirect');
        if (redirect) {
          sessionStorage.removeItem('spa-redirect');
          // Use replaceState to restore the proper URL without adding to history
          window.history.replaceState(null, null,
            window.location.pathname.replace(/\/$/, '') + '/' + redirect
          );
        }
      })();
    </script>
    <script>
      // Version checker for cache busting
      (function() {
        var VERSION_KEY = 'kcl-app-version';
        var BASE_PATH = '/kansas-city-lowball/';
        
        function checkVersion() {
          fetch(BASE_PATH + 'version.json?t=' + Date.now(), { cache: 'no-store' })
            .then(function(res) { return res.json(); })
            .then(function(data) {
              var currentVersion = localStorage.getItem(VERSION_KEY);
              if (currentVersion && currentVersion !== data.version) {
                console.log('New version detected, clearing cache and reloading...');
                localStorage.setItem(VERSION_KEY, data.version);
                
                // Clear all caches, then reload after completion
                if ('caches' in window) {
                  caches.keys()
                    .then(function(names) {
                      return Promise.all(names.map(function(name) {
                        return caches.delete(name);
                      }));
                    })
                    .then(function() {
                      window.location.reload(true);
                    })
                    .catch(function() {
                      // Reload anyway if cache clearing fails
                      window.location.reload(true);
                    });
                } else {
                  // No cache API available, just reload
                  window.location.reload(true);
                }
              } else if (!currentVersion) {
                localStorage.setItem(VERSION_KEY, data.version);
              }
            })
            .catch(function(err) {
              console.log('Version check failed:', err);
            });
        }
        
        // Check version on page load
        checkVersion();
        
        // Also check when page becomes visible (user returns to tab)
        document.addEventListener('visibilitychange', function() {
          if (document.visibilityState === 'visible') {
            checkVersion();
          }
        });
      })();
    </script>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
